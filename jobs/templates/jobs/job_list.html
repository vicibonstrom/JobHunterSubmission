{% extends "base.html" %}

{% block content %}
  <h2>Job Listings</h2>

  {% if user.is_authenticated %}
    <a href="{% url 'jobs:add_job' %}" class="btn btn-primary">Add Job Listing</a>
  {% endif %}

  <form method="get" action=".">
    <div>
      <label for="category">Filter by category:</label>
      <select name="category" id="category">
        <option value="">All</option>
        {% for category in categories %}
          <option value="{{ category.id }}" {% if selected_category == category.id|stringformat:"s" %}selected{% endif %}>{{ category.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label for="company">Filter by company:</label>
      <input type="text" name="company" id="company" value="{{ selected_company }}">
    </div>
    <div>
      <label for="order_by">Order by:</label>
      <select name="order_by" id="order_by">
        <option value="due_date" {% if selected_order_by == "due_date" %}selected{% endif %}>Due date of offering</option>
      </select>
    </div>
      <div>
      <label for="search">Search by title:</label>
      <input type="text" name="search" id="search" value="{{ search_query }}">
    </div>
  
    <div>
      <button type="submit">Apply Filters</button>
    </div>
  </form>

  <div class="jobs">
    {% if jobs %}
      {% for job in jobs %}
        <div class="job">
          <h3><a href="{% url 'jobs:job_detail' job.pk %}">{{ job.title }}</a></h3>
          <p>{{ job.description|truncatewords:20 }}</p>
          <p>Category: {{ job.category.name }}</p>
          <p>Company: {{ job.company }}</p>
          <p>Due Date: {{ job.due_date }}</p>
        </div>
      {% endfor %}
    {% else %}
      <p>No job listings found.</p>
    {% endif %}
  </div>
{% endblock %}
